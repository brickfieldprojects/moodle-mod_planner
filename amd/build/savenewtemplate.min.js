define("mod_planner/savenewtemplate",["exports","core/modal_factory","./modal_save_new_template","./events","core/modal_events","core/ajax","core/notification"],(function(_exports,_modal_factory,_modal_save_new_template,_events,_modal_events,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Creates the modal for the saving a new template.
   *
   * @author      Jay Churchward <jay@brickfieldlabs.ie>
   * @copyright   2021 Brickfield Education Labs <jay@brickfieldlabs.ie>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_save_new_template=_interopRequireDefault(_modal_save_new_template),_events=_interopRequireDefault(_events),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);const show=async function(){let{focusOnClose:focusOnClose=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const modal=await _modal_factory.default.create({type:_modal_save_new_template.default.TYPE});modal.show(),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy();try{focusOnClose.focus()}catch(e){}})),modal.getRoot().on(_events.default.savenewtemplate,(e=>{e.preventDefault();const templateNameElement=document.getElementById("newTemplateName"),templateName=templateNameElement.value,disclaimer=document.getElementById("id_disclaimereditable").innerHTML,stepName=[],stepAllocation=[],stepDescription=[],names=document.querySelectorAll('[selector="planner_stepname"]'),allocs=document.querySelectorAll('[selector="planner_stepallocation"]'),errorMessage=document.getElementById("id_error_message");for(let i=0;i<names.length;i++)stepName.push(names[i].value),stepAllocation.push(allocs[i].value),stepDescription.push(document.getElementById("id_stepdescription_"+i+"editable").innerHTML);_ajax.default.call([{methodname:"mod_planner_save_new_template",args:{name:templateName,disclaimer:disclaimer,personal:isPersonal,stepname:stepName,stepallocation:stepAllocation,stepdescription:stepDescription,optionrepeats:names.length},done:data=>{if(""!==data)templateNameElement.classList.add("is-invalid"),errorMessage.innerText=data,errorMessage.style.display="block";else{modal.destroy();try{focusOnClose.focus()}catch(e){}}},fail:_notification.default.exception}])}))},init=personal=>{isPersonal=personal,init.initialised||(init.initialised=!0,document.addEventListener("click",(e=>{const trigger=e.target.closest("#id_savenewtemplate");trigger&&(e.preventDefault(),show(trigger,{focusOnClose:e.target}))})))};_exports.init=init;let isPersonal="";init.initialised=!1}));

//# sourceMappingURL=savenewtemplate.min.js.map